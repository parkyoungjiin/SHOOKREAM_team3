<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.shookream.mapper.WishMapper">
	<select id="getProduct" resultType="com.itwillbs.shookream.vo.ProductBean">
		SELECT * 
			FROM product
			WHERE product_idx=#{product_idx}
	</select>
	
	<select id="getImage" resultType="com.itwillbs.shookream.vo.imageBean">
		SELECT image_main_file, image_real_file1, image_real_file2  
			FROM image 
			WHERE product_idx =#{product_idx}
	</select>
	
	<insert id="InsertLike">
		<selectKey keyProperty="wish_idx" resultType="int" order="BEFORE">
			<!-- 가장 큰 글번호(board_num) 조회 -->
			SELECT MAX(wish_idx) FROM wish
		</selectKey>
		INSERT
			INTO wish
			VALUES (
				#{wish_idx} + 1
				,#{member_idx}
				,#{product_idx}	
			)
	</insert>
	
	<delete id="DeleteWish">
		DELETE FROM wish 
			WHERE member_idx=#{member_idx} AND product_idx=#{product_idx}
	</delete>
	
	<select id="getWishList" resultType="com.itwillbs.shookream.vo.ProductBean">
		SELECT w.wish_idx, i.image_main_file,m.member_id,p.product_price,p.product_name,
					p.product_brand,p.product_size,p.product_color,p.product_idx 
					FROM wish w JOIN product p JOIN member m JOIN image i
					ON w.product_idx = p.product_idx AND w.member_idx = m.member_idx AND w.product_idx = i.product_idx
					WHERE m.member_idx=#{member_idx} 
					LIMIT #{startRow},#{listLimit}
	</select>	
	
	<select id="getWishListCount" resultType="int">
		SELECT COUNT(wish_idx) 
				FROM wish
				WHERE member_idx = #{member_idx}
	</select>
	
	<update id="updateWishCount">
		UPDATE product p INNER JOIN wish w 
					ON p.product_idx = w.product_idx 
					SET p.product_wishcount = p.product_wishcount+1
					WHERE p.product_idx = #{product_idx}
	</update>
	
	<update id="DecWishCount">
		UPDATE product p INNER JOIN wish w 
					ON p.product_idx = w.product_idx 
					SET p.product_wishcount = p.product_wishcount-1
					WHERE p.product_idx = #{product_idx}
	</update>
	
</mapper>
